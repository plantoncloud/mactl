package moom

import (
	"github.com/pkg/errors"
	"github.com/plantoncloud/mactl/internal/installer/mas"
	"github.com/plantoncloud/mactl/internal/lib/plist"
	log "github.com/sirupsen/logrus"
)

const (
	AppStoreId = "419330170"
	AppGroupId = "com.manytricks.Moom"
	PlistB64   = `YnBsaXN0MDDYAQIDBAUGBwgJCgkLM3MJM18QEEFwcGxpY2F0aW9uIE1vZGVfEB9BdXRvbWF0aWMgTmV3cyBVcGRhdGVzOiBWZXJzaW9uXxAYQ29uZmlndXJhdGlvbiBHcmlkOiBSb3dzXxAPQ3VzdG9tIENvbnRyb2xzXxAmQXV0b21hdGljIE5ld3MgVXBkYXRlczogUG9wcGVkIFVwIE9uY2VfEDROU1Rvb2xiYXIgQ29uZmlndXJhdGlvbiBQcmVmZXJlbmNlcyAoQXBwIFN0b3JlKSAzMTc0XxAbQ29uZmlndXJhdGlvbiBHcmlkOiBDb2x1bW5zXFN0ZWFsdGggTW9kZRACEAalDDlIV2XfEBUNDg8QERITFBUWFxgZGhscHR4fICEiIiMkJSQnKCkqMTIzJCIiJyQ2JDhfEA9Nb3ZlIERlbHRhIFVuaXRfEBFSZXNpemUgV2lkdGggVW5pdFVUaXRsZV8QFVJlc2l6ZSBQcm9wb3J0aW9uYWxseVZBY3Rpb25cQXV0by1UcmlnZ2VyXxAdTW92ZSB0byBFZGdlL0Nvcm5lciBEaXJlY3Rpb25aSWRlbnRpZmllcl1SZXNpemUgQW5jaG9yV0hvdCBLZXlaTW92ZSBEZWx0YV8QGkF1dG8tVHJpZ2dlciBEaXNwbGF5IENvdW50WUNvbGxhcHNlZF8QFUxvb3AgVGhyb3VnaCBEaXNwbGF5c1tDZW50ZXIgTW9kZV8QElJlc2l6ZSBIZWlnaHQgVW5pdF5Nb3ZlIERpcmVjdGlvbl8QHEFwcGx5IHRvIE92ZXJsYXBwaW5nIFdpbmRvd3NeUmVsYXRpdmUgRnJhbWVfEBJDb25maW5lIHRvIERpc3BsYXlbUmVzaXplIFNpemUQAF8QFlNBTVBMRSBDVVNUT00gQ09OVFJPTFMIECkIEAVfECRCQ0YwOThDNS1BNzcwLTQwQTYtOUM4QS0yQjM0QzJFMzY5QUMQCtQrFCwtLigvMF8QFVZpc3VhbCBSZXByZXNlbnRhdGlvblhLZXkgQ29kZV5Nb2RpZmllciBGbGFnc2UjAyMlIecjGAAnECcSAB4BKxAyEAEJCAhfEDl7ezAuMTY2NjY2NjY2NjY2NjY2NjYsIDAuMjV9LCB7MC42NjY2NjY2NjY2NjY2NjY2MywgMC41fX0IWns4MDAsIDYwMH3fEBQNDhIQERMUFRYXGBkaGxwdHh8gISIiJCQ8Jz0pPjEyJCQiIickRSRHCAgQE18QJDFEMzdDMjk3LUU0OUEtNDZCMS1CNUVFLThEQTZFRjY0QjY2NNQrFCwtP0BBMGUjAyMlIecjGABGXxAkMUQzN0MyOTctRTQ5QS00NkIxLUI1RUUtOERBNkVGNjRCNjY0EAMICAhfEBB7ezAsIDB9LCB7MSwgMX19CFp7ODAwLCA2MDB93xAUDQ4SEBETFBUWFxgZGhscHR4fICEiIiQkPCdLKUwxMiQkIiInJFQkVggIXxAkOEM0N0M0MzUtMDgwQS00Qjk4LUI1MzYtNTRCRUQxQTE1MjFE1CsULC1NTk9QZSMDIyUh5yMYIZJfECQ4QzQ3QzQzNS0wODBBLTRCOTgtQjUzNi01NEJFRDFBMTUyMUQQfBIAvgErCAgIXxAUe3swLjUsIDB9LCB7MC41LCAxfX0IWns4MDAsIDYwMH3fEBQNDhIQERMUFRYXGBkaGxwdHh8gISIiJCQ8J1opWzEyJCQiIickYiRkCAhfECRFMzM4NDU2Ni0yQTUxLTQ5REMtODQxQi0zMkIwODFBRTE2REHUKxQsLVxdXlBlIwMjJSHnIxghk18QJEUzMzg0NTY2LTJBNTEtNDlEQy04NDFCLTMyQjA4MUFFMTZEQRB9CAgIXxASe3swLCAwfSwgezEsIDAuNX19CFt7MTUzNiwgOTM1fd8QFA0OEhARExQVFhcYGRobHB0eHyAhIiIkJDwnaClpMTIkJCIiJyRvJHEICF8QJEQ3MzgzNzdCLTFFQTUtNDA0RC05QjBCLTVFQTdDMDFCMkU5RtQrFCwtamhrUGUjAyMlIecjGCGQEHsICAhfEBJ7ezAsIDB9LCB7MC41LCAxfX0IW3sxNTM2LCA5MzV9CdR0dXZ3MjIyMltUQiBJcyBTaG93bl8QEVRCIEljb24gU2l6ZSBNb2RlXFRCIFNpemUgTW9kZV8QD1RCIERpc3BsYXkgTW9kZQkACAAZACwATgBpAHsApADbAPkBBgEIAQoBEAE9AU8BYwFpAYEBiAGVAbUBwAHOAdYB4QH+AggCIAIsAkECUAJvAn4CkwKfAqECugK7Ar0CvgLAAucC6QLyAwoDEwMiAy0DLwM0AzYDOAM5AzoDOwN3A3gDgwOuA68DsAOyA9kD4gPtBBQEFgQXBBgEGQQsBC0EOARjBGQEZQSMBJUEoATHBMkEzgTPBNAE0QToBOkE9AUfBSAFIQVIBVEFXAWDBYUFhgWHBYgFnQWeBaoF1QXWBdcF/gYHBhIGFAYVBhYGFwYsBi0GOQY6BkMGTwZjBnAGggAAAAAAAAIBAAAAAAAAAHkAAAAAAAAAAAAAAAAAAAaD`
)

// Install moom from app store using mas
func Install() error {
	if err := mas.Install(AppStoreId); err != nil {
		return errors.Wrapf(err, "failed to install")
	}
	return nil
}

// Configure will restore config using plistB64 file
func Configure() error {
	log.Infof("importing moom config from plist file")
	if err := plist.Import(AppGroupId, PlistB64); err != nil {
		return errors.Wrapf(err, "failed to import %s plist file", AppGroupId)
	}
	log.Infof("imported moom config from plist file")
	return nil
}
